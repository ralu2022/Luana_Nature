<!doctype html >
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Luana Nature</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/.css/css.css">

</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<!-- Meniu -->
<nav class="navbar navbar-expand-sm bg-white fixed-top">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavleft">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/companies}"><b>Companii</b></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/individuals}"><b>Individual</b></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/kids}"><b>Lumea copiilor</b></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/store}"><b>Magazinul nostru</b></a>
                </li>
            </ul>
        </div>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/index}"><b>Delogare</b></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <b>Rezervări</b>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" th:href="@{/reservations/reservations}">Rezervările mele</a></li>
                        <li><a class="dropdown-item" th:href="@{/reservations/reservation}">Rezervare nouă</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/aboutus}"><b>Despre noi</b></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       th:href="@{/contact}"><b>Contact</b></a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<br>

<br><br>
<div class="card" style="width: 100%; position: relative;">
    <img class="card-img-top" src="/pictures/magazin_0.webp" alt="Centered image" style="height: 500px;
    width: 100%;object-fit: cover;">
    <br><br><br><br>
    <div class="container mt-5">
        <h2>Produsele noastre</h2>
        <br><br>
        <div class="row">
            <div th:each="product : ${products}" class="col-md-4">
                <div class="card mb-4">
                    <img th:src="@{/pictures/produse_1.jpeg}"
                         th:if="${product.name == 'Honey Bunny'}"
                         class="card-img-top" alt="Imagine produs">
                    <img th:src="@{/pictures/cana_0.webp}"
                         th:if="${product.name == 'Puffy cups'}"
                         class="card-img-top" alt="Imagine produs">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${product.name}">Denumire produs</h5>
                        <p class="card-text">
                            Preț: <span th:text="${product.price}">Pret</span> RON
                        </p>
                        <p class="card-text">
                            Descriere: <span th:text="${product.description}">Descriere</span>
                        </p>
                        <button class="btn btn-primary"
                                th:attr="data-product-id=${product.productId}, data-product-name=${product.name}, data-product-price=${product.price}"
                                onclick="handleAddToOrder(this)"
                                type="button">Add to Order</button>
                        <script>
                            // Initialize an empty array to store the order
                            const order = [];

                            /**
                             * Function to handle adding a product to the order
                             * @param {HTMLElement} buttonElement - The button element that triggered the event
                             */
                            function handleAddToOrder(buttonElement) {
                                const productId = parseInt(buttonElement.getAttribute('data-product-id')); // Parse product ID as an integer
                                const productName = buttonElement.getAttribute('data-product-name'); // Get product name
                                const productPrice = parseFloat(buttonElement.getAttribute('data-product-price')); // Parse price as a float

                                // Validate price
                                if (isNaN(productPrice)) {
                                    alert(`Invalid price for product: ${productName}`);
                                    return;
                                }

                                addToOrder(productId, productName, productPrice);
                            }

                            /**
                             * Add a product to the order array
                             * @param {number} productId - The ID of the product
                             * @param {string} productName - The name of the product
                             * @param {number} price - The price of the product
                             */
                            function addToOrder(productId, productName, price) {
                                // Check if the product already exists in the order
                                const existingProduct = order.find(item => item.id === productId);
                                if (existingProduct) {
                                    // Increment the quantity if the product is already in the order
                                    existingProduct.quantity += 1;
                                } else {
                                    // Add a new product to the order
                                    order.push({ id: productId, name: productName, price: price, quantity: 1 });
                                }
                                updateOrderPreview(); // Update the order preview
                            }

                            /**
                             * Update the order preview displayed on the page
                             */
                            function updateOrderPreview() {
                                const orderPreview = document.getElementById('orderPreview');
                                orderPreview.innerHTML = ''; // Clear the existing preview

                                // Iterate through the order and display each item
                                order.forEach(item => {
                                    const total = item.price * item.quantity; // Calculate total price for the product

                                    // Validate total
                                    if (isNaN(total)) {
                                        alert(`Invalid total for product: ${item.name}`);
                                        return;
                                    }

                                    // Create a row for the product in the preview
                                    const productRow = document.createElement('div');
                                    productRow.textContent = `${item.name} (x${item.quantity}) - ${total.toFixed(2)} RON`;
                                    orderPreview.appendChild(productRow);
                                });
                            }

                            /**
                             * Submit the order to the server
                             */
                            async function submitOrder() {
                                // Check if the order is empty
                                if (order.length === 0) {
                                    alert('Your order is empty!');
                                    return;
                                }

                                try {
                                    // Send the order to the server
                                    const response = await fetch('/products/submitOrder', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(order) // Send the order as JSON
                                    });

                                    if (response.ok) {
                                        alert('Order submitted successfully!');
                                        order.length = 0; // Clear the order
                                        updateOrderPreview(); // Update the preview
                                    } else {
                                        alert('Failed to submit the order!');
                                    }
                                } catch (error) {
                                    alert('An error occurred while submitting the order!');
                                    console.error(error); // Log the error for debugging
                                }
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
        <br><br>
        <h2>Your Order</h2>
        <div id="orderPreview"></div>
        <br>
        <button onclick="submitOrder()" class="btn btn-success">Place Order</button>

        <br><br>
    </div>
</div>
<br><br><br>


<!-- Nota subsol -->
<footer class="text-center text-lg-start bg-body-tertiary text-muted">
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
    </section>
    <section class="">
        <div class="container text-center text-md-start mt-5">
            <div class="row mt-3">
                <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">
                        <i class=""></i>Luana Nature
                    </h6>
                </div>
                <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">
                        Link-uri utile
                    </h6>
                    <p>
                        <a th:href="@{/companies}" class="text-reset">Companii</a>
                    </p>
                    <p>
                        <a th:href="@{/individuals}" class="text-reset">Individual</a>
                    </p>
                    <p>
                        <a th:href="@{/kids}" class="text-reset">Lumea copiilor</a>
                    </p>
                    <p>
                        <a th:href="@{/store}" class="text-reset">Magazinul nostru</a>
                    </p>
                </div>

                <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                    <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
                    <p><i class="fas fa-home me-3"></i> Comuna Fundata, Brasov, RO</p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        luananature2024@gmail.com
                    </p>
                    <p><i class="fas fa-phone me-3"></i> + 40 268 477 698</p>
                    <p><i class="fas fa-mobile-alt me-3"></i> + 40 724 789 718</p>
                    <h6 class="text-uppercase fw-bold mb-4">Rețele sociale</h6>
                    <a href="https://www.facebook.com/profile.php?id=61569606121431" class="me-4"
                       style="color: darkslategrey">
                        <p><i class="fab fa-facebook-f"></i> Facebook </p>
                    </a>
                    <a href="https://www.instagram.com/" class="me-4 text-reset">
                        <p><i class="fab fa-instagram"></i> Instagram </p>
                    </a>
                </div>
                <div>
                </div>
            </div>
        </div>
    </section>

    <div class="text-center p-4 me-3" style="background-color: rgba(0, 0, 0, 0.05);">
        © 2024
        <a class="text-reset me-3" href="termsofservice.html">Termene și condiții</a>
        <a class="text-reset me-3" href="termsofservice.html">Politica de confidențialitate</a>
        <a class="text-reset" href="termsofservice.html">Imprint</a>
    </div>
</footer>

</body>
</html>
